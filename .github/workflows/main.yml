name: Package Pet Clinic

on: 
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        java: [ '17' ]

    steps:
      - uses: actions/checkout@v2
      - name: Set up JDK ${{matrix.java}}
        uses: actions/setup-java@v2
        with:
          java-version: ${{matrix.java}}
          distribution: 'adopt'
          cache: maven
      - name: Build with Maven Wrapper
        run: ./mvnw -B package
        
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        java: [ '17' ]

    steps:
      - uses: actions/checkout@v2
      - name: Set up JDK ${{matrix.java}}
        uses: actions/setup-java@v2
        with:
          java-version: ${{matrix.java}}
          distribution: 'adopt'
          cache: maven
      - name: Test with Maven Wrapper
        run: ./mvnw -B test
           
        
  build-and-publish:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Set up JDK 1.8
        uses: actions/setup-java@v1
        with:
          java-version: 1.8
      - name: Build with Maven
        run: mvn -B package
        
      - name: NPM Bump
        uses: bcomnes/npm-bump@v2.1.0
        id: npm_bump # A unique id for the step
        with:
          git_email: ${{ secrets.GIT_EMAIL }}
          git_username: ${{ github.actor }}
          newversion: ${{ steps.version_input.outputs.version_bump }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          npm_token: ${{ secrets.NPM_TOKEN }}

      - name: Get Version Input
        id: version_input
        uses: bcomnes/version-input-action@v1.0.1
        with:
          version_bump: major # Allow user to choose the type of version bump
